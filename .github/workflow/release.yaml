name: Auto Release Static Site

on:
  push:
    tags:
      - 'v*.*.*'  # Срабатывает на теги вида v1.0.0, v2.1.3 и т.д.

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      # 1. Клонируем репозиторий
      - uses: actions/checkout@v3

      # 2. Копируем все файлы кроме .git
      - name: Prepare release files
        run: |
          mkdir release_temp
          shopt -s extglob
          cp -r !(release_temp|.git) release_temp/
          cd release_temp
          zip -r ../release.zip ./*

      # 3. Создаём релиз на GitHub
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 4. Загружаем zip как asset
      - name: Upload release assets
        uses: softprops/action-gh-release@v1
        with:
          files: release.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
